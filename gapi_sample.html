<!doctype html>
<html>
  <head>
    <script>
		skip_titles = ["President of the United States","Vice-President of the United States","Lieutenant Governor","Sheriff","Treasurer","County Clerk","City Attorney","Assessor-Recorder","District Attorney","San Francisco County Superior Court Judge","State Treasurer","State Treasurer","State Controller","Secretary of State","Insurance Commissioner","State Superintendent of Public Instruction","Attorney General"]; // Do not display politicians with these titles
		var x;
      /**
       * Build and execute request to look up voter info for provided address.
       * @param {string} address Address for which to fetch voter info.
       * @param {function(Object)} callback Function which takes the
       *     response object as a parameter.
       */
       function lookup(address, callback) {
       /**
         * Election ID for which to fetch voter info.
         * @type {number}
         */
        var electionId = 2000;
 
        /**
         * Request object for given parameters.
         * @type {gapi.client.HttpRequest}
         */
        var req = gapi.client.request({
            'path' : '/civicinfo/v2/representatives',
            'params' : {'address' : address}
        });
       req.execute(callback);
      }

      /**
       * Render results in the DOM.
       * @param {Object} response Response object returned by the API.
       * @param {Object} rawResponse Raw response from the API.
       */
      function renderResults(response, rawResponse) {
		x = response;
		results = []
		for (i = 0; i<response.offices.length; i++) {
			for (j = 0; j < response.offices[i].officialIndices.length; j++) {
				result = {}
				office_title = response.offices[i].name;
				result["title"] = office_title;
				official_index = response.offices[i].officialIndices[j];
				result["name"] = response.officials[official_index].name;
				if ("urls" in response.officials[official_index] && response.officials[official_index].urls.length > 0) {
					result["url"] = response.officials[official_index].urls[0];
				}
				if (skip_titles.indexOf(office_title) < 0) {
					results.push(result);
				}
			}
		}
        var el = document.getElementById('results');
		el.innerHTML = '';
		for (i = 0; i<results.length; i++)
		{
			new_paragraph = document.createElement("p");
			new_paragraph.appendChild(document.createTextNode(results[i]["title"]));
			new_paragraph.appendChild(document.createTextNode(": "));
			if ("url" in results[i]) {
				ahref_node = document.createElement("a");
				ahref_node.setAttribute("href",results[i]["url"]);
				ahref_node.innerHTML = results[i]["name"];
				new_paragraph.appendChild(ahref_node);
			}
			else {
				new_paragraph.appendChild(document.createTextNode(results[i]["name"]));
			}
			el.appendChild(new_paragraph);
			el.appendChild(document.createElement("p"));
		}
      }

      /**
       * Initialize the API client and make a request.
       */
      function load() {
        gapi.client.setApiKey('AIzaSyCu5mDa-j8751oDEp-pVnj8zjZKnA4A4T0');
        lookup(document.getElementById("user_address").value, renderResults);
      }
    </script>
    <script src="http://apis.google.com/js/client.js"></script>
  </head>
  <body>
	<form onsubmit='load()' method='post' style='display:inline;' target="frame">
		 Address: <input type='text' name='user_address' id='user_address'><input type='submit' value='Submit'>
	</form>
    <div id="results">
    </div>
	<iframe name="frame" style="display: none;"></iframe>
  </body>
</html>
